##**Паук для обработки входящих файлов из директории.**

###_Цель проекта_

<blockquote>Данный паук работает по таймеру, каждый раз при срабатывании таймер
запускается обход по директории обозначенной в настройках. 
Каждый найденный файл анализируется на предмет совпадения шаблона.
Если файл соответствует шаблону, то содержимое файла помещается в бд, а
сам в файл в специальную директорию, в случае не соответствия шаблону, файл
просто переносится в специальную директорию.</blockquote>

###_Сборка и запуск_
Собрать проект можно любой из двух следующих команд команд:
* gradle buildDistr
* gradlew buildDistr

Результатом сборки будет являться артифакт директория _dist_ содержащая собранный дистрибутив.
 - _crawler-1.0.jar_ - артифакт приложения
 - crawler.properties - файл с настройками приложения
 - entry.xsd - файл схемы для валидации входных фалов
 - start.bat - скрипт содержащий команду для запуска приложжения в Windows
 - start.sh - скрипт содержащий команду для запуска приложжения в Linux
 - init.sql - скрипт для создания таблицы в бд

Для запуска проекта можно выполнить команду

<blockquote>java -jar <путь до артифакта crawler-1.0.jar> -properties.location <путь до файла crawler.properties></blockquote>

В частном случае когда оба файла находятся в одной папке и запуск производится из нее команда будет выглядеть следующим 
образом

<blockquote>java -jar crawler-1.0.jar -properties.location crawler.properties</blockquote>

Так же в папке scripts подготовленны скрипты содержащие данную команду на случай, когда файыл расположенны в одной папке.

Помимо скриптов запуска в папке scripts расположен файл _`init.sql`_ предназначенный для создания таблицы в которую будут 
помещаться файлы. После создания таблицы не забудьте выдать права на данную таблицу пользователю, из под которого будет работать 
приложение.

Все скрипты после сборки попадают в папку distr.

###_Файл crawler.properties_

Данный файл содержит настройки необходимые для работы приложения.

* `monitor.schedule.timeout` - периодичность мониторинга папки с файлами в миллесекундах (значение по умолчанию 30 секунд) 
* `processor.temp.dir` - папка для хранения временных фалов "транзакций"
* `processor.max_thread_count` - количество потоков для обработки данных
* `processor.success.dir` - папка для размещения успешно обработанных фалов
* `processor.fail.dir` - папка для файлов, которые не соответствуют шаблону
* `monitor.dir` - папка в которой будет производится мониторинг новых фалов
* `entry.xsd.schema.file` - путь до файла со схемой, для валидации входных файлов
* `db.connection.string` - строка подключения к базе данных
* `db.login` - логин к бд
* `db.password` - пароль к бд

<blockquote>
Настройки по умолчанию не могут быть использованы в большинстве случаев, приведены как пример
</blockquote>

<blockquote>
Все настройки должны быть заданы и соответствовать действительности - иначе приложение не запуститься и сообщит о причине в лог файл и в консоль.
</blockquote>

###_Валидация входных файлов_

Валидция осуществляется посредством XSD схемы, так как на данный момент паук умеет обрабатывать 
только XML файлы. Однако его функциональность легко можно расширить реализовав интерфейс _Analyzer_.

###_Процессинг и восстановление_

Процессинг файлов происходит в несколько потоков. По таймеру с интервалом заданным в настройках, 
начинается обход директории. Все найденные файлы запускаются в обработку в отдельном потоке. В случае если в пуле потоков
отсутсвует свободный поток, то дальнейшая обработка ставится на паузу в ожиании свободного потока.

При старте перед тем как начать обрабатывать файлы система производит попытку восстановления, на случай если перед этим было 
непредвиденное завершение и какие то файлы остались недообработанными. Восстановление системы происходит в один поток влизбежания
конкуренции за ресурсы с основным процессом обраотки файлов. После восстановления системы вся обработка происходит в мультипоточном режиме.
Данной момент не является критичным, так как количество файлов при восстановлении максимально может быть равно количеству потоков
при запуске приложения в предыдущий раз. В любом случае данное место может быть подвергнуто рефакторингу.
